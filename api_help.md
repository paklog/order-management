# Fulfillment Order Management API - Developer Guide

## 1. Overview

Welcome to the Fulfillment Order Management API! This guide is designed to help developers understand and integrate with our RESTful API for managing the entire lifecycle of fulfillment orders.

The primary use case for this API is to allow sellers and integrated systems to programmatically submit new orders for fulfillment, track the status of those orders as they are processed in our warehouse, and request cancellations when necessary.

Our API is built with an asynchronous-first approach, meaning that actions like creating or canceling an order will kick off a workflow rather than completing instantaneously. This design accurately reflects the real-world processes of physical fulfillment and provides a robust and scalable integration point.

**Base URL:** `https://api.example.com/fulfillment/order_management/v1`

## 2. Core Concepts

Before you start integrating, it's important to understand these key concepts that govern the API's design and behavior.

### Asynchronous Processing

When you submit a request to create or cancel an order, the API will first validate and accept the request, responding immediately with `202 Accepted`. This response indicates that your request has been successfully received and queued for processing. It does **not** mean the order has been shipped or that the cancellation is complete.

To get the current state of an order, you must poll the `GET /fulfillment_orders/{order_id}` endpoint and check the `status` field in the response.

### Idempotency: A Tale of Two Keys

To ensure data integrity and prevent accidental duplication, the API uses two different identifiers during order creation. Understanding their roles is critical for a successful integration.

1.  **`Idempotency-Key` (HTTP Header)**
    *   **Purpose:** To guarantee that a network request can be safely retried without causing side effects.
    *   **How it works:** A client should generate a unique UUID for this header for every new request they wish to make idempotent. If our server receives a request with an `Idempotency-Key` it has already processed, it will not re-process the request. Instead, it will return the original result for that request. This is crucial for safely handling network timeouts or connection errors.
    *   **Scope:** Guarantees a single request is processed only once.

2.  **`seller_fulfillment_order_id` (Request Body Field)**
    *   **Purpose:** To guarantee business-level uniqueness for an order from a specific seller.
    *   **How it works:** This is your internal order identifier. Our system uses this ID to ensure you don't accidentally submit the same order twice in two different requests. If you attempt to create a new order with a `seller_fulfillment_order_id` that already exists in our system, the API will reject the request with a `409 Conflict` error.
    *   **Scope:** Guarantees an order is unique within your seller account.

### Identifiers

You will encounter several types of IDs when using the API:

| Field Name | Description | Where It's Used |
| :--- | :--- | :--- |
| `order_id` | A unique, system-generated UUID for the fulfillment order. | This is the canonical ID for the order within our system. **Use this ID for all subsequent API calls** (`GET`, `cancel`, etc.). |
| `seller_fulfillment_order_id` | The seller-provided unique identifier for the order. | Required during order creation. |
| `displayable_order_id` | The customer-facing identifier. | Required during order creation. |
| `seller_fulfillment_order_item_id` | The seller-provided unique identifier for a specific line item within an order. | Required for each item during order creation. |

---

## 3. API Endpoints

### Create a new Fulfillment Order

`POST /fulfillment_orders`

This endpoint submits a new fulfillment order to the system. The request is processed asynchronously. A successful submission will be met with a `202 Accepted` response containing the initial state of the fulfillment order, including its unique system-generated `order_id`.

#### Headers

| Header | Required | Description |
| :--- | :--- | :--- |
| `Idempotency-Key` | Yes | A unique key (e.g., a UUID) generated by the client to guarantee that retries of this request are processed only once. |

#### Request Body

The request body must be a JSON object with the following structure:

**Example Request:**
```json
{
  "seller_fulfillment_order_id": "seller-abc-123",
  "displayable_order_id": "cust-po-456",
  "displayable_order_date": "2025-10-05T10:00:00Z",
  "displayable_order_comment": "Thank you for your order!",
  "shipping_speed_category": "STANDARD",
  "destination_address": {
    "name": "John Doe",
    "address_line_1": "123 Main St",
    "address_line_2": "Apt 4B",
    "city": "Anytown",
    "state_or_region": "CA",
    "postal_code": "12345",
    "country_code": "US"
  },
  "items": [
    {
      "seller_sku": "item-xyz-789",
      "seller_fulfillment_order_item_id": "line-item-1",
      "quantity": 1,
      "gift_message": "Happy Birthday!",
      "displayable_comment": "Handle with care"
    }
  ]
}
```

#### Responses

*   **`202 Accepted`**: The request was successfully received and is being processed. The response body will contain the newly created `FulfillmentOrder` resource.
*   **`400 Bad Request`**: The request body is invalid, missing required fields, or contains malformed data.
*   **`409 Conflict`**: A fulfillment order with the provided `seller_fulfillment_order_id` already exists.

---

### Get Fulfillment Order by ID

`GET /fulfillment_orders/{order_id}`

Retrieves the current state and complete details of a specific fulfillment order using its system-generated unique ID (`order_id`). This is the primary way to track the status of an order after it has been created.

#### Path Parameters

| Parameter | Type | Description |
| :--- | :--- | :--- |
| `order_id` | `string` (uuid) | **Required.** The unique system-generated identifier for the fulfillment order. |

#### Responses

*   **`200 OK`**: The request was successful. The response body contains the full `FulfillmentOrder` object.

**Example Response:**
```json
{
  "order_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "seller_fulfillment_order_id": "seller-abc-123",
  "displayable_order_id": "cust-po-456",
  "displayable_order_date": "2025-10-05T10:00:00Z",
  "displayable_order_comment": "Thank you for your order!",
  "shipping_speed_category": "STANDARD",
  "destination_address": {
    "name": "John Doe",
    "address_line_1": "123 Main St",
    "address_line_2": "Apt 4B",
    "city": "Anytown",
    "state_or_region": "CA",
    "postal_code": "12345",
    "country_code": "US"
  },
  "status": "RECEIVED",
  "items": [
    {
      "seller_sku": "item-xyz-789",
      "seller_fulfillment_order_item_id": "line-item-1",
      "quantity": 1,
      "gift_message": "Happy Birthday!",
      "displayable_comment": "Handle with care"
    }
  ],
  "received_date": "2025-10-05T10:00:15Z"
}
```

*   **`404 Not Found`**: No fulfillment order was found for the provided `order_id`.

---

### Cancel a Fulfillment Order

`POST /fulfillment_orders/{order_id}/cancel`

Requests the cancellation of an existing fulfillment order. This operation is also asynchronous and will be acknowledged with a `202 Accepted` response.

**Business Rule:** Cancellation is only possible if the order has not yet been shipped. If the order is too far along in the fulfillment process, the request will be rejected.

#### Path Parameters

| Parameter | Type | Description |
| :--- | :--- | :--- |
| `order_id` | `string` (uuid) | **Required.** The unique system-generated identifier for the fulfillment order to be canceled. |

#### Responses

*   **`202 Accepted`**: The cancellation request has been accepted and is being processed. You should poll the `GET /fulfillment_orders/{order_id}` endpoint to confirm when the `status` changes to `CANCELLED`.
*   **`400 Bad Request`**: The order is not in a state that allows cancellation (e.g., it has already been shipped).
*   **`404 Not Found`**: No fulfillment order was found for the provided `order_id`.

---

## 4. Data Models

### The FulfillmentOrder Object

This is the central resource in the API, representing a single fulfillment order.

| Field | Type | Description |
| :--- | :--- | :--- |
| `order_id` | `string` (uuid) | The unique system-generated identifier. |
| `seller_fulfillment_order_id` | `string` | The seller's unique identifier for the order. |
| `displayable_order_id` | `string` | The identifier shown to the recipient. |
| `displayable_order_date` | `string` (date-time) | The order date shown to the recipient. |
| `displayable_order_comment` | `string` | A comment shown to the recipient. |
| `shipping_speed_category` | `string` | The requested shipping speed (e.g., "STANDARD", "EXPRESS"). |
| `destination_address` | `Address` object | The shipping destination. |
| `status` | `string` | The current status of the order (e.g., "RECEIVED", "SHIPPED", "CANCELLED"). |
| `items` | array of `OrderItem` objects | The list of items included in the order. |
| `received_date` | `string` (date-time) | The timestamp when the order was received by our system. |

### The OrderItem Object

| Field | Type | Description |
| :--- | :--- | :--- |
| `seller_sku` | `string` | **Required.** The seller's unique identifier for the item. |
| `seller_fulfillment_order_item_id` | `string` | **Required.** The seller's unique identifier for this specific line item. |
| `quantity` | `integer` | **Required.** The number of units for this item. Must be at least 1. |
| `gift_message` | `string` | An optional gift message for the item. |
| `displayable_comment` | `string` | An optional comment for the item (e.g., for the packer). |

### The Address Object

| Field | Type | Description |
| :--- | :--- | :--- |
| `name` | `string` | **Required.** The recipient's full name. |
| `address_line_1` | `string` | **Required.** The primary street address. |
| `address_line_2` | `string` | Optional secondary address information (e.g., apartment, suite). |
| `city` | `string` | **Required.** The city. |
| `state_or_region` | `string` | **Required.** The state, province, or region. |
| `postal_code` | `string` | **Required.** The postal code. |
| `country_code` | `string` | **Required.** The two-letter ISO 3166-1 alpha-2 country code. |

## 5. Typical Workflow Example

1.  **Submit the Order:** Your system generates a new order. You send a `POST /fulfillment_orders` request with a unique `Idempotency-Key` header and your order details in the body.

2.  **Receive Acceptance and ID:** The API validates your request and responds with `202 Accepted`. You parse the response body to get the system's `order_id` (e.g., "a1b2c3d4-e5f6-7890-1234-567890abcdef"). You should store this `order_id` and associate it with your internal order.

3.  **Track Order Status:** Periodically, your system can make a `GET /fulfillment_orders/a1b2c3d4-e5f6-7890-1234-567890abcdef` request to fetch the latest status. You can check the `status` field in the response to see if it has moved from `RECEIVED` to `VALIDATED`, `SHIPPED`, etc.

4.  **Cancel the Order (if needed):** If the customer requests a cancellation and the order has not yet shipped, you can send a `POST /fulfillment_orders/a1b2c3d4-e5f6-7890-1234-567890abcdef/cancel` request. You will get a `202 Accepted` response. You should then continue to poll the `GET` endpoint until the status confirms the change to `CANCELLED`.
